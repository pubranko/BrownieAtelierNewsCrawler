name: GitHub Actions Demo
run-name: ${{ github.actor }} is testing out GitHub Actions ðŸš€
on: 
    # ä»¥ä¸‹ã®ãƒ–ãƒ©ãƒ³ãƒã«ãƒ—ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸéš›èµ·å‹•
    push:
        branches: ["github-actions-test"]
    # Githubã‚ˆã‚Šæ‰‹å‹•ã§èµ·å‹•
    workflow_dispatch:

# env:
#     AAA: bbb

jobs:
  GitHub-Actions-Test:
    runs-on: ubuntu-22.04

    env:
        MONGO_INITDB_ROOT_USERNAME: root_user
        MONGO_INITDB_ROOT_PASSWORD: password
        BROWNIE_ATELIER_MONGO__MONGO_USE_DB: test_crawler_db
        BROWNIE_ATELIER_MONGO__MONGO_USER: common_user
        BROWNIE_ATELIER_MONGO__MONGO_PASS: password

    steps:
        # "ðŸŽ‰ ã‚¸ãƒ§ãƒ–ã¯ãƒ—ãƒƒã‚·ãƒ¥ ã‚¤ãƒ™ãƒ³ãƒˆã«ã‚ˆã£ã¦è‡ªå‹•çš„ã«ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã¾ã—ãŸã€‚" 
      - run: echo "ðŸŽ‰ èµ·å‹•ã—ãŸã‚¤ãƒ™ãƒ³ãƒˆã®ç¨®é¡žï¼š ${{ github.event_name }}"
        # ã€ŒðŸ§ ã“ã®ã‚¸ãƒ§ãƒ–ã¯ç¾åœ¨ã€GitHub ã«ã‚ˆã£ã¦ãƒ›ã‚¹ãƒˆã•ã‚Œã¦ã„ã‚‹ Linux ã‚µãƒ¼ãƒãƒ¼ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã¾ã™!ã€
      - run: echo "ðŸ§ githubä¸Šã®OSã®ç¨®é¡žï¼š ${{ runner.os }}"
        # "ðŸ”Ž ãƒ–ãƒ©ãƒ³ãƒã®åå‰ã¯ refs/heads/github-actions-testã€ãƒªãƒã‚¸ãƒˆãƒªã¯ pubranko/BrownieAtelier ã§ã™ã€‚" ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
      - run: echo "ðŸ”Ž ãƒªãƒã‚¸ãƒˆãƒªåï¼š ${{ github.repository }}."
      - run: echo "ðŸ”Ž ãƒ–ãƒ©ãƒ³ãƒåï¼š ${{ github.ref }}"
        # ä¸Šè¨˜ã®ãƒªãƒã‚¸ãƒˆãƒªãƒ»ãƒ–ãƒ©ãƒ³ãƒã«ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      - name: ä¸Šè¨˜ãƒªãƒã‚¸ãƒˆãƒªãƒ»ãƒ–ãƒ©ãƒ³ãƒã«ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

        # ðŸ–¥ï¸ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯ãƒ©ãƒ³ãƒŠãƒ¼ã§ã‚³ãƒ¼ãƒ‰ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹æº–å‚™ãŒã§ãã¾ã—ãŸã€‚ã€
      - run: echo "ðŸ–¥ï¸ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯ãƒ©ãƒ³ãƒŠãƒ¼ã§ã‚³ãƒ¼ãƒ‰ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹æº–å‚™ãŒã§ãã¾ã—ãŸã€‚"
        # 
      - name: ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã§æ ¼ç´ã—ãŸçµæžœã‚’ç¢ºèª
        # ã‚¯ãƒ­ãƒ¼ãƒ³å¾Œã¯ã“ã“ã«ã‚½ãƒ¼ã‚¹ãŒæ ¼ç´ã•ã‚Œã‚‹ /home/runner/work/BrownieAtelier/BrownieAtelier
        run: |
          ls -a ${{ github.workspace }}
        # "ðŸ This job's status is success."
      - run: echo "ðŸ å®Ÿè¡Œå¾Œã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼š ${{ job.status }}."

      # ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã®ä¸€è¦§ã‚’èª¿ã¹ã¦ã¿ãŸã€‚
      #- run: sudo apt list --installed
      #- run: sudo dpkg-query -l

      - name: Start MongoDB
        run:  >
          docker run -d
          --name mongo-container
          -p 27017:27017
          -v $PWD/mongodb/init/create-user.js:/docker-entrypoint-initdb.d/create-user.js
          -e MONGO_INITDB_ROOT_USERNAME=${MONGO_INITDB_ROOT_USERNAME}
          -e MONGO_INITDB_ROOT_PASSWORD=${MONGO_INITDB_ROOT_PASSWORD}
          -e BROWNIE_ATELIER_MONGO__MONGO_USE_DB=${BROWNIE_ATELIER_MONGO__MONGO_USE_DB}
          -e BROWNIE_ATELIER_MONGO__MONGO_USER=${BROWNIE_ATELIER_MONGO__MONGO_USER}
          -e BROWNIE_ATELIER_MONGO__MONGO_PASS=${BROWNIE_ATELIER_MONGO__MONGO_PASS}
          mongo:7.0.1-jammy

      # - run: sleep 30

      - run: docker ps -a

      - run: docker stop mongo-container

      - run: sleep 10

      - run: docker ps -a

