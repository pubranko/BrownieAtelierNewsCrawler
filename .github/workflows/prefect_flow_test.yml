name: Prefect Flow Test
run-name: Prefect Flow Test!!!
on:
    # ä»¥ä¸‹ã®ãƒ–ãƒ©ãƒ³ãƒã«ãƒ—ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸéš›èµ·å‹•
    push:
        branches:
          - 'feature/**'
    # Githubã‚ˆã‚Šæ‰‹å‹•ã§èµ·å‹•
    workflow_dispatch:

jobs:
  ##########################################
  # ãƒ†ã‚¹ãƒˆæº–å‚™
  ##########################################
  Prefect-Flow-Test-Preparation:
    runs-on: ubuntu-22.04
    environment:
      name: TEST
    env:
        ## dockerfile_baseã§å‚ç…§ã™ã‚‹ubuntuã‚¤ãƒ¡ãƒ¼ã‚¸ã®ã‚¿ã‚°
        UBUNTU_TAG: 22.04
        ## # dockerfileã§å‚ç…§ã™ã‚‹baseã‚¤ãƒ¡ãƒ¼ã‚¸ã®ã‚¿ã‚°
        # BASE_TAG: test-0.15
        # docker-composeã§å‚ç…§ã™ã‚‹new_crawlerã‚¤ãƒ¡ãƒ¼ã‚¸ã®ã‚¿ã‚°ã€‚ã“ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å†…ã§ã¯latestå›ºå®šã¨ã™ã‚‹ã€‚
        NEWS_CRAWLER_TAG: latest
        # ã‚³ãƒ³ãƒ†ãƒŠãƒ¼å†…rootãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
        CONTAINER_ROOT_PASS: password
        # ã‚³ãƒ³ãƒ†ãƒŠå†…ã®ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
        CONTAINER_USER: common_user
        CONTAINER_USER_PASS: password
        # ãƒ–ãƒ©ã‚¦ãƒ‹ãƒ¼å·¥æˆ¿ã®gitãƒªãƒ¢ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªãƒ¼
        GIT_REMOTE_REPOSITORY: https://github.com/pubranko/BrownieAtelierNewsCrawler.git
        # ä¸Šè¨˜ãƒªãƒã‚¸ãƒˆãƒªãƒ¼ã®gitãƒ–ãƒ©ãƒ³ãƒ
        # GIT_BRANCH: ${{ github.ref }}
        # GIT_BRANCH: ${{github.head_ref}}
        GIT_BRANCH: ${{github.ref_name}}
        # Firefox ã® gecko driver
        GECKO_DRIVER: https://github.com/mozilla/geckodriver/releases/download/v0.33.0/geckodriver-v0.33.0-linux64.tar.gz

        # dummy
        HOST_OS_IP_ADDRESS: 192.0.0.1

        # Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã® tar ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–å‡ºåŠ›å…ˆã®ãƒ‘ã‚¹
        PATH_CACHE: /tmp/docker-img-arch

        # ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³
        TZ: "Asia/Tokyo"
    steps:
      - run: echo "ğŸ‰ èµ·å‹•ã‚¤ãƒ™ãƒ³ãƒˆã®ç¨®é¡ (${{ github.event_name }})"
      - run: echo "ğŸ§ githubä¸Šã®OSã®ç¨®é¡ (${{ runner.os }})"
      - name: ãƒªãƒã‚¸ãƒˆãƒª(${{ github.repository }})ãƒ»ãƒ–ãƒ©ãƒ³ãƒ(${{github.ref_name}})ã«ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        # ä¸Šè¨˜ã®ãƒªãƒã‚¸ãƒˆãƒªãƒ»ãƒ–ãƒ©ãƒ³ãƒã«ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

      - name: ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ãƒã‚§ãƒƒã‚¯
        # ãƒ†ã‚¹ãƒˆå‰ãƒã‚§ãƒƒã‚¯ã‚’ç¢ºèª
        # ã‚¯ãƒ­ãƒ¼ãƒ³å¾Œã¯ã“ã“ã«ã‚½ãƒ¼ã‚¹ãŒæ ¼ç´ã•ã‚Œã‚‹ /home/runner/work/BrownieAtelierNewsCrawler/BrownieAtelierNewsCrawler
        run: |
          ls -a ${{ github.workspace }}

      # ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã®ä¸€è¦§ã‚’èª¿ã¹ã¦ã¿ãŸã€‚
      #- run: sudo apt list --installed
      #- run: sudo dpkg-query -l

      #################################################
      # baseã‚¤ãƒ¡ãƒ¼ã‚¸ã‚³ãƒ³ãƒ†ãƒŠãƒ¼
      #################################################

      - name: baseã‚¤ãƒ¡ãƒ¼ã‚¸ç”¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®å®šç¾© & å¾©å…ƒ
        # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ID ã®å®šç¾©
        id: base_image_cache
        uses: actions/cache@v4
        with:
          path: ${{ env.PATH_CACHE }}
          key: ${{ runner.os }}-brownie-atelier-news-crawler-base-${{ vars.BASE_TAG }}

      # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒã‚ã‚‹å ´åˆã¯ tar ã‚’dockerã«ãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚¤ãƒ¡ãƒ¼ã‚¸ã«è¿½åŠ 
      - name: baseç”¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒã‚ã‚‹å ´åˆã¯ tar ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚¤ãƒ¡ãƒ¼ã‚¸ä¸€è¦§ã«è¿½åŠ 
        if: steps.base_image_cache.outputs.cache-hit == 'true'
        run: |
          ls -l ${{ env.PATH_CACHE }}
          docker load --input ${{ env.PATH_CACHE }}/${{ runner.os }}-brownie-atelier-news-crawler-base-${{ vars.BASE_TAG }}.tar
          docker images

      - name: baseã‚¤ãƒ¡ãƒ¼ã‚¸ãŒã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ãªã„å ´åˆã«buildã¨save(ã‚­ãƒ£ãƒƒã‚·ãƒ¥)ã‚’å®Ÿè¡Œ
        if: steps.base_image_cache.outputs.cache-hit != 'true'
        # git branchã«ã¯developã‚’å›ºå®šã§å‰²ã‚Šå½“ã¦ã¨ã™ã‚‹ã€‚ new_crawlerã‚¤ãƒ¡ãƒ¼ã‚¸ä½œæˆå´ã§ä¿®æ­£ä¸­ã®ãƒ–ãƒ©ãƒ³ãƒã‚„masterç­‰ã‚’é©ç”¨ã™ã‚‹é‹ç”¨ã¨ã™ã‚‹ã€‚ 
        run: |
          mkdir ${{ env.PATH_CACHE }}
          export GIT_BRANCH=${{ env.GIT_BRANCH }}
          export BASE_TAG=${{ vars.BASE_TAG }}
          docker compose -f docker-compose__base-image-build.yml build
          docker save brownie-atelier-news-crawler-base:${{ vars.BASE_TAG }} -o ${{ env.PATH_CACHE }}/${{ runner.os }}-brownie-atelier-news-crawler-base-${{ vars.BASE_TAG }}.tar
          ls -l ${{ env.PATH_CACHE }}
          docker images


      #################################################
      # new_crawlerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚³ãƒ³ãƒ†ãƒŠãƒ¼
      #################################################
      - name: new_crawlerã‚¤ãƒ¡ãƒ¼ã‚¸build
        # new_crawlerã‚¤ãƒ¡ãƒ¼ã‚¸ä½œæˆ
        run: |
          export BASE_TAG=${{ vars.BASE_TAG }}
          docker compose -f docker-compose__news-crawler-image-build.yml build
          docker images

      - name: new_crawlerã‚¤ãƒ¡ãƒ¼ã‚¸ã«åˆ¥åã®ã‚¿ã‚°ã‚’ä»˜ä¸ â€»ãƒªãƒã‚¸ãƒˆãƒªåã‚’å°æ–‡å­—ã«å¤‰æ›
        run: |
          REPO_NAME=$(echo "${{ github.repository }}" | tr '[:upper:]' '[:lower:]')
          docker tag brownie-atelier-news-crawler:${{ env.NEWS_CRAWLER_TAG }}  ghcr.io/${REPO_NAME}/brownie-atelier-news-crawler:${{ env.NEWS_CRAWLER_TAG }}

      - name: ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ãƒ¬ã‚¸ã‚¹ãƒˆãƒªãƒ¼ã«ãƒ­ã‚°ã‚¤ãƒ³
        uses: docker/login-action@v3
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GHCR_TOKEN }} # æ›¸ãè¾¼ã¿ãƒ»å‚ç…§æ¨©é™

      - name: new_crawlerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ãƒ¬ã‚¸ã‚¹ãƒˆãƒªãƒ¼ã«ãƒ—ãƒƒã‚·ãƒ¥
        run: |
          REPO_NAME=$(echo "${{ github.repository }}" | tr '[:upper:]' '[:lower:]')
          docker push ghcr.io/${REPO_NAME}/brownie-atelier-news-crawler:${{ env.NEWS_CRAWLER_TAG }}

  ########################################
  # ãƒ†ã‚¹ãƒˆæœ¬ä½“
  ########################################
  Prefect-Flow-Test:
    needs: [Prefect-Flow-Test-Preparation]
    runs-on: ubuntu-22.04
    environment:
      name: TEST
    env:
        ## mongoDBç”¨ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã§å‚ç…§ã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ã‚¿ã‚°
        MONGO_TAG: 7.0.1-jammy
        ## dockerfile_baseã§å‚ç…§ã™ã‚‹ubuntuã‚¤ãƒ¡ãƒ¼ã‚¸ã®ã‚¿ã‚°
        UBUNTU_TAG: 22.04
        ## # dockerfileã§å‚ç…§ã™ã‚‹baseã‚¤ãƒ¡ãƒ¼ã‚¸ã®ã‚¿ã‚°
        # BASE_TAG: test-0.15
        # docker-composeã§å‚ç…§ã™ã‚‹new_crawlerã‚¤ãƒ¡ãƒ¼ã‚¸ã®ã‚¿ã‚°ã€‚ã“ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å†…ã§ã¯latestå›ºå®šã¨ã™ã‚‹ã€‚
        NEWS_CRAWLER_TAG: latest
        # ã‚³ãƒ³ãƒ†ãƒŠå†…ã®ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
        CONTAINER_USER: common_user
        CONTAINER_USER_PASS: password
        # ä¸Šè¨˜ãƒªãƒã‚¸ãƒˆãƒªãƒ¼ã®gitãƒ–ãƒ©ãƒ³ãƒ
        # GIT_BRANCH: ${{ github.ref }}
        # GIT_BRANCH: ${{github.head_ref}}
        GIT_BRANCH: ${{github.ref_name}}

        # ãƒ›ã‚¹ãƒˆï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ï¼‰å´ã®mongoDBæ¥ç¶šç”¨ã®crtã‚„pemãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿ç®¡ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
        LOCAL_MONGO_KEY_DIR: /tmp

        # docker compose commandé¸æŠ
        CONTAINER_START_COMMAND: /bin/sh -c "/home/common_user/BrownieAtelierNewsCrawler/sh/prefect_run_and_server_start.sh"

        # mongoDBã‚³ãƒ³ãƒ†ãƒŠãƒ¼ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã€mongoDBæ¥ç¶šæƒ…å ±
        BROWNIE_ATELIER_MONGO__MONGO_SERVER: mongo-server
        BROWNIE_ATELIER_MONGO__MONGO_PORT: 27017
        BROWNIE_ATELIER_MONGO__MONGO_USE_DB: test_crawler_db
        BROWNIE_ATELIER_MONGO__MONGO_USER: mongo_user
        BROWNIE_ATELIER_MONGO__MONGO_PASS: mongo_pass
        BROWNIE_ATELIER_MONGO__MONGO_TLS: false
        BROWNIE_ATELIER_MONGO__MONGO_TLS_CA_FILE:
        BROWNIE_ATELIER_MONGO__MONGO_TLS_CERTTIFICATE_KEY_FILE:
        # mongoDBã‚³ãƒ³ãƒ†ãƒŠãƒ¼rootæƒ…å ±
        BROWNIE_ATELIER_MONGO__MONGO_INITDB_ROOT_USERNAME: root_user
        BROWNIE_ATELIER_MONGO__MONGO_INITDB_ROOT_PASSWORD: password
        # Brownie atelier noticeã®è¨­å®š (slack)
        BROWNIE_ATELIER_NOTICE__SLACK_TOKEN: ${{ secrets.BROWNIE_ATELIER_NOTICE__SLACK_TOKEN}}
        BROWNIE_ATELIER_NOTICE__SLACK_CHANNEL_ID__ERROR: ${{ secrets.BROWNIE_ATELIER_NOTICE__SLACK_CHANNEL_ID__ERROR}}
        BROWNIE_ATELIER_NOTICE__SLACK_CHANNEL_ID__NOMAL: ${{ secrets.BROWNIE_ATELIER_NOTICE__SLACK_CHANNEL_ID__NOMAL}}

        # dummy
        HOST_OS_IP_ADDRESS: 192.0.0.1
        # dummy
        PREFECT_HOME: /home/common_user/BrownieAtelierNewsCrawler/data/prefect_data # ã‚³ãƒ³ãƒ†ãƒŠãƒ¼å†…ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ
        PREFECT_API_URL: ${{secrets.PREFECT_API_URL}}
        PREFECT__API_KEY:
        PREFECT__WORK_SPACE:
        PREFECT__WORK_POOL:
        SLEEP_TIME_AFTER_PREFECT_SERVER_STARTUP: 20
        SCRAPY__LOG_LEVEL: INFO

        # Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã® tar ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–å‡ºåŠ›å…ˆã®ãƒ‘ã‚¹
        PATH_CACHE: /tmp/docker-img-arch

        # ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³
        TZ: "Asia/Tokyo"
    steps:
      - run: echo "ğŸ‰ èµ·å‹•ã‚¤ãƒ™ãƒ³ãƒˆã®ç¨®é¡ (${{ github.event_name }})"
      - run: echo "ğŸ§ githubä¸Šã®OSã®ç¨®é¡ (${{ runner.os }})"
      - name: ãƒªãƒã‚¸ãƒˆãƒª(${{ github.repository }})ãƒ»ãƒ–ãƒ©ãƒ³ãƒ(${{github.ref_name}})ã«ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        # ä¸Šè¨˜ã®ãƒªãƒã‚¸ãƒˆãƒªãƒ»ãƒ–ãƒ©ãƒ³ãƒã«ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

      - name: ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ãƒã‚§ãƒƒã‚¯
        # ãƒ†ã‚¹ãƒˆå‰ãƒã‚§ãƒƒã‚¯ã‚’ç¢ºèª
        # ã‚¯ãƒ­ãƒ¼ãƒ³å¾Œã¯ã“ã“ã«ã‚½ãƒ¼ã‚¹ãŒæ ¼ç´ã•ã‚Œã‚‹ /home/runner/work/BrownieAtelierNewsCrawler/BrownieAtelierNewsCrawler
        run: |
          ls -a ${{ github.workspace }}

      ########################################################################
      # ãƒ†ã‚¹ãƒˆç”¨ã«dockerãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŒå¿…è¦ã§ã‚ã‚‹ãŸã‚ä½œæˆ
      ########################################################################
      - name: dockerãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ãƒ†ã‚¹ãƒˆç”¨ã«ä½œæˆ
        # dockerãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½œæˆ
        run: docker network create brownie-atelier-net

      #################################################
      # mongoDBã‚³ãƒ³ãƒ†ãƒŠãƒ¼
      #################################################
      - name: ãƒ†ã‚¹ãƒˆç”¨MongoDBã‚³ãƒ³ãƒ†ãƒŠãƒ¼pull & èµ·å‹•
        # mongoDBã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã®ä½œæˆã€‚
        #   rootãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ä½¿ç”¨DBåã‚’æŒ‡å®šã€‚
        #   ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’create-user.jsã§è‡ªå‹•ä½œæˆã€‚
        run:  >
          docker run -d
          --name mongo-server
          -p 27017:27017
          --network brownie-atelier-net
          -v $PWD/mongodb/init/create-user.js:/docker-entrypoint-initdb.d/create-user.js
          -e MONGO_INITDB_ROOT_USERNAME=${BROWNIE_ATELIER_MONGO__MONGO_INITDB_ROOT_USERNAME}
          -e MONGO_INITDB_ROOT_PASSWORD=${BROWNIE_ATELIER_MONGO__MONGO_INITDB_ROOT_PASSWORD}
          -e BROWNIE_ATELIER_MONGO__MONGO_USE_DB=${BROWNIE_ATELIER_MONGO__MONGO_USE_DB}
          -e BROWNIE_ATELIER_MONGO__MONGO_USER=${BROWNIE_ATELIER_MONGO__MONGO_USER}
          -e BROWNIE_ATELIER_MONGO__MONGO_PASS=${BROWNIE_ATELIER_MONGO__MONGO_PASS}
          mongo:${MONGO_TAG}

      - run: |
          docker images
          docker ps -a

      ########################################################################
      # new_crawlerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ—ãƒ«
      ########################################################################
      - name: ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ãƒ¬ã‚¸ã‚¹ãƒˆãƒªãƒ¼ã«ãƒ­ã‚°ã‚¤ãƒ³
        uses: docker/login-action@v3
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GHCR_TOKEN }} # æ›¸ãè¾¼ã¿ãƒ»å‚ç…§æ¨©é™

      - name: new_crawlerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ—ãƒ«
        run: |
          REPO_NAME=$(echo "${{ github.repository }}" | tr '[:upper:]' '[:lower:]')
          docker pull ghcr.io/${REPO_NAME}/brownie-atelier-news-crawler:${{ env.NEWS_CRAWLER_TAG }}

      - name: new_crawlerã‚¤ãƒ¡ãƒ¼ã‚¸ã«åˆ¥åã®ã‚¿ã‚°ã‚’ä»˜ä¸
        run: |
          REPO_NAME=$(echo "${{ github.repository }}" | tr '[:upper:]' '[:lower:]')
          docker tag ghcr.io/${REPO_NAME}/brownie-atelier-news-crawler:${{ env.NEWS_CRAWLER_TAG }}  brownie-atelier-news-crawler:${{ env.NEWS_CRAWLER_TAG }}
          docker images

      #################################################
      # new_crawlerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚’èµ·å‹•ã—ã¦å„ç¨®ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œ
      #################################################
      - name: "<1>å„ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚µã‚¤ãƒˆåˆ¥ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã®æƒ…å ±ç™»éŒ²  <2>å®šæœŸè¦³æ¸¬ç”¨ã®ã‚¹ãƒ‘ã‚¤ãƒ€ãƒ¼ç™»éŒ²  <3>åˆå›å®šæœŸè¦³æ¸¬"
        env:
          TZ: ${{ vars.TZ}}
        # å„ç¨®ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆ
        run: |
          export PREFECT_RUN_SCRIPT="prefect_lib/github_actions_unit_tests/github_actions_unit_test_01.py"
          docker compose -f docker-compose__news-crawler-container.yml up --abort-on-container-exit
          exit_code=$?
          exit $exit_code

      - name: "<4>æ‰‹å‹•ã‚¯ãƒ­ãƒ¼ãƒªãƒ³ã‚°"
        env:
          TZ: ${{ vars.TZ}}
        run: |
          export PREFECT_RUN_SCRIPT="prefect_lib/github_actions_unit_tests/github_actions_unit_test_02.py"
          docker compose -f docker-compose__news-crawler-container.yml up --abort-on-container-exit
          exit_code=$?
          exit $exit_code

      - name: "<5>å®šæœŸè¦³æ¸¬ã®ON/OFF  <6>å®šæœŸè¦³æ¸¬"
        env:
          TZ: ${{ vars.TZ}}
        run: |
          export PREFECT_RUN_SCRIPT="prefect_lib/github_actions_unit_tests/github_actions_unit_test_03.py"
          docker compose -f docker-compose__news-crawler-container.yml up --abort-on-container-exit
          exit_code=$?
          exit $exit_code

      - name: "<7>æ‰‹å‹•ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°  <8>æ‰‹å‹•ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚¯ãƒªãƒƒãƒ—ãƒã‚¹ã‚¿ãƒ¼ä¿å­˜"
        env:
          TZ: ${{ vars.TZ}}
        run: |
          export PREFECT_RUN_SCRIPT="prefect_lib/github_actions_unit_tests/github_actions_unit_test_04.py"
          docker compose -f docker-compose__news-crawler-container.yml up --abort-on-container-exit
          exit_code=$?
          exit $exit_code

      - name: "<9>Scrapyçµ±è¨ˆæƒ…å ±é›†è¨ˆ  <10>Scrapyçµ±è¨ˆæƒ…å ±ãƒ¬ãƒãƒ¼ãƒˆ"
        env:
          TZ: ${{ vars.TZ}}
        run: |
          export PREFECT_RUN_SCRIPT="prefect_lib/github_actions_unit_tests/github_actions_unit_test_05.py"
          docker compose -f docker-compose__news-crawler-container.yml up --abort-on-container-exit
          exit_code=$?
          exit $exit_code

      - name: "<11>ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ¬ãƒãƒ¼ãƒˆ  <12>åŒæœŸãƒã‚§ãƒƒã‚¯"
        env:
          TZ: ${{ vars.TZ}}
        run: |
          export PREFECT_RUN_SCRIPT="prefect_lib/github_actions_unit_tests/github_actions_unit_test_06.py"
          docker compose -f docker-compose__news-crawler-container.yml up --abort-on-container-exit
          exit_code=$?
          exit $exit_code

      - name: "<13>mongoDBã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ  <14>mongoDBå‰Šé™¤  <15>mongoDBã‚¤ãƒ³ãƒãƒ¼ãƒˆ"
        env:
          TZ: ${{ vars.TZ}}
        run: |
          export PREFECT_RUN_SCRIPT="prefect_lib/github_actions_unit_tests/github_actions_unit_test_07.py"
          docker compose -f docker-compose__news-crawler-container.yml up --abort-on-container-exit
          exit_code=$?
          exit $exit_code

      - name: "<16>æ—¥æ¬¡æœå‡¦ç†"
        env:
          TZ: ${{ vars.TZ}}
        run: |
          export PREFECT_RUN_SCRIPT="prefect_lib/github_actions_unit_tests/github_actions_unit_test_08.py"
          docker compose -f docker-compose__news-crawler-container.yml up --abort-on-container-exit
          exit_code=$?
          exit $exit_code

      # "ğŸ This job's status is success."
      - run: echo "ğŸ Jobå®Ÿè¡Œå¾Œã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼š ${{ job.status }}."
